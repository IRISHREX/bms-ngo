import { createContext, ReactNode, useContext, useEffect, useMemo, useState } from "react";

export type Language = "en" | "bn" | "hi" | "ar";

const LANGUAGE_STORAGE_KEY = "ngo_language";

const localeMap: Record<Language, string> = {
  en: "en-IN",
  bn: "bn-BD",
  hi: "hi-IN",
  ar: "ar",
};

const translations: Record<Language, Record<string, string>> = {
  en: {
    "lang.en": "English",
    "lang.bn": "Bangla",
    "lang.hi": "Hindi",
    "lang.ar": "Arabic",
    "site.name": "HopeFoundation",
    "nav.home": "Home",
    "nav.about": "About Us",
    "nav.work": "Our Work",
    "nav.programs": "Programs",
    "nav.gallery": "Gallery",
    "nav.blog": "Blog",
    "nav.notices": "Notices",
    "nav.transparency": "Transparency",
    "cta.donateNow": "Donate Now",
    "cta.volunteer": "Volunteer",
    "admin.dashboard": "Dashboard",
    "admin.files": "File Manager",
    "admin.projects": "Projects",
    "admin.volunteers": "Volunteers",
    "admin.donations": "Donations",
    "admin.usersRoles": "Users & Roles",
    "admin.logout": "Logout",
    "language.label": "Language",
    "footer.tagline": "Providing free education, healthcare, and empowerment to rural communities since 2021.",
    "footer.quickLinks": "Quick Links",
    "footer.getInvolved": "Get Involved",
    "footer.partner": "Partner With Us",
    "footer.transparency": "Transparency",
    "footer.reports": "View Annual Reports",
    "footer.rights": "All rights reserved.",
    "home.hero.badge": "Since 2021 - West Bengal, India",
    "home.hero.title": "Providing Free Education to Rural Students",
    "home.hero.desc": "We empower underserved communities through education, healthcare, and sustainable development programs across rural India.",
    "home.hero.volunteer": "Become Volunteer",
    "home.hero.work": "See Our Work",
    "home.stats.students": "Students Helped",
    "home.stats.meals": "Meals Served",
    "home.stats.villages": "Villages Reached",
    "home.stats.volunteers": "Active Volunteers",
    "home.work.title": "Our Work",
    "home.work.desc": "Real programs creating real impact in underserved communities",
    "home.work.fundUtilization": "Fund utilization",
    "home.work.viewAll": "View All Projects",
    "home.notices.title": "Latest Announcements",
    "home.notices.published": "Published: {date}",
    "home.notices.all": "All Notices",
    "home.blog.title": "Stories of Impact",
    "home.blog.desc": "People donate to stories, not spreadsheets",
    "home.blog.readAll": "Read All Stories",
    "home.cta.title": "Every Contribution Matters",
    "home.cta.desc": "Your INR 500 can provide a month of education for a rural child. Join us in building a better tomorrow.",
    "gallery.title": "Gallery",
    "gallery.subtitle": "Moments from the field - proof of impact",
    "gallery.noPhotos": "No photos found for this category.",
    "gallery.untitled": "Untitled",
    "gallery.all": "All",
    "gallery.events": "Events",
    "gallery.beneficiaries": "Beneficiaries",
    "gallery.volunteers": "Volunteers",
    "gallery.fieldVisits": "Field Visits",
    "donate.title": "Make a Donation",
    "donate.subtitle": "Your contribution directly funds education, healthcare, and food for rural communities.",
    "donate.type": "Donation Type",
    "donate.oneTime": "One-time",
    "donate.monthly": "Monthly",
    "donate.selectAmount": "Select Amount",
    "donate.customAmount": "Or enter custom amount",
    "donate.fullName": "Full Name",
    "donate.email": "Email",
    "donate.phoneOptional": "Phone (optional)",
    "donate.submit": "Donate INR {amount}",
    "donate.submitMonthlySuffix": "/ month",
    "donate.submitting": "Submitting...",
    "donate.taxNote": "80G tax exemption receipt will be sent to your email. All donations are tax-deductible.",
    "donate.toast.successTitle": "Donation submitted",
    "donate.toast.successDesc": "Thank you for your support.",
    "donate.toast.failedTitle": "Donation failed",
    "donate.toast.missingTitle": "Missing field",
    "donate.toast.missingDesc": "Full name is required.",
    "donate.toast.invalidTitle": "Invalid amount",
    "donate.toast.invalidDesc": "Minimum donation is INR 100.",
    "volunteer.title": "Get Involved",
    "volunteer.subtitle": "Join our mission - whether as a volunteer, partner, or intern",
    "volunteer.role.volunteer": "Volunteer",
    "volunteer.role.partner": "Partner",
    "volunteer.role.intern": "Intern",
    "volunteer.application": "{type} Application",
    "volunteer.joinPrompt": "Why do you want to join?",
    "volunteer.partnerPrompt": "Organization & Partnership Details",
    "volunteer.phone": "Phone",
    "volunteer.submit": "Submit Application",
    "volunteer.submitting": "Submitting...",
    "volunteer.toast.successTitle": "Application submitted",
    "volunteer.toast.successDesc": "Thanks for joining our mission.",
    "volunteer.toast.failedTitle": "Submission failed",
    "volunteer.toast.missingTitle": "Missing field",
    "volunteer.toast.missingDesc": "Full name is required.",
    "dashboard.title": "Dashboard",
    "dashboard.subtitle": "Overview of your NGO operations",
    "dashboard.platform": "Platform",
    "dashboard.impact": "Impact",
    "dashboard.themeStudio": "Theme Studio",
    "dashboard.themeDesc": "Change site theme via API",
    "dashboard.recentActivity": "Recent Activity",
    "dashboard.noActivity": "No recent activity yet.",
    "dashboard.stat.totalDonations": "Total Donations",
    "dashboard.stat.volunteers": "Volunteers",
    "dashboard.stat.photos": "Photos",
    "dashboard.stat.notices": "Notices",
    "dashboard.stat.blogPosts": "Blog Posts",
    "dashboard.stat.projects": "Projects",
    "dashboard.stat.donationAmount": "Donation Amount",
    "dashboard.desc.totalFunds": "Total funds raised",
    "dashboard.desc.education": "Through education programs",
    "dashboard.desc.food": "Food distribution drives",
    "dashboard.desc.states": "Across 3 states",
    "dashboard.trend.donationsMonth": "+12% this month",
    "dashboard.trend.volunteersWeek": "+5 this week",
    "dashboard.trend.quarter": "+18% this quarter",
    "time.justNow": "just now",
    "time.minAgo": "{count} min ago",
    "time.hourAgo": "{count} hour ago",
    "time.dayAgo": "{count} day ago",
    "transparency.title": "Financial Transparency",
    "transparency.subtitle": "We believe in complete transparency. All our financial reports and audit documents are publicly available.",
    "transparency.snapshot": "Financial Snapshot",
    "transparency.totalRaised": "Total Raised",
    "transparency.totalDisbursed": "Total Disbursed",
    "transparency.availableBalance": "Available Balance",
    "transparency.donationMix": "Donation Mix",
    "transparency.noDonations": "No donation records available yet.",
    "transparency.downloadReports": "Download Reports",
    "transparency.noReports": "No reports uploaded yet.",
    "transparency.publishedTypeDate": "{type} - {date}",
    "about.title": "About HopeFoundation",
    "about.subtitle": "Building brighter futures for rural India through education, healthcare, and community empowerment since 2021.",
    "about.mission.title": "Our Mission",
    "about.mission.body": "To provide free, quality education and essential services to underserved rural communities, empowering individuals to break the cycle of poverty and build self-sustaining futures.",
    "about.vision.title": "Our Vision",
    "about.vision.body": "A world where every child has access to education, healthcare, and opportunities regardless of their geographical or socioeconomic background. We envision thriving rural communities that are self-empowered and resilient.",
    "about.founder.title": "Founder's Message",
    "about.founder.quote": "\"When I visited the remote villages of West Bengal in 2020, I saw children walking miles just to find a school. That moment changed everything for me. HopeFoundation was born from a simple belief that education is not a privilege, but a right. Every child we reach is a life transformed.\"",
    "about.founder.byline": "- Founder, HopeFoundation",
    "about.journey.title": "Our Journey",
    "about.timeline.2021.title": "Foundation Established",
    "about.timeline.2021.desc": "Registered as an NGO in West Bengal with a team of 5 volunteers.",
    "about.timeline.2022.title": "First Education Center",
    "about.timeline.2022.desc": "Opened our first free learning center serving 120 students in rural West Bengal.",
    "about.timeline.2023.title": "Expanding Reach",
    "about.timeline.2023.desc": "Launched medical camps and food distribution programs across 15 villages.",
    "about.timeline.2024.title": "Women Empowerment",
    "about.timeline.2024.desc": "Started skill development programs for rural women in Bihar and West Bengal.",
    "about.timeline.2025.title": "Growing Impact",
    "about.timeline.2025.desc": "3,200+ students helped, 45+ villages reached, and counting.",
    "about.docs.title": "Registration & Certificates",
    "about.docs.subtitle": "Full transparency - all our legal documents are publicly available",
    "about.doc.ngo.title": "NGO Registration",
    "about.doc.ngo.desc": "Registration No: XXXXX/2021",
    "about.doc.80g.title": "80G Certificate",
    "about.doc.80g.desc": "Tax exemption for donors under Section 80G",
    "about.doc.12a.title": "12A Registration",
    "about.doc.12a.desc": "Income tax exemption certificate",
    "about.docs.download": "Download PDF",
    "impact.title": "Our Impact",
    "impact.subtitle": "Real numbers, real lives changed. Every project is tracked transparently.",
    "impact.fundsRaised": "Funds Raised",
    "impact.allProjects": "All Projects",
    "impact.budgetUtilization": "Budget utilization",
    "impact.used": "used",
    "impact.total": "total",
    "impact.cta": "Want to support our projects?",
    "programs.title": "Our Programs",
    "programs.subtitle": "Four focused initiatives creating lasting change across rural India",
    "programs.education.title": "Education Program",
    "programs.education.desc": "Free quality education for rural children through learning centers, scholarships, and mentorship.",
    "programs.education.h1": "500+ students enrolled",
    "programs.education.h2": "15 learning centers",
    "programs.education.h3": "100% first-generation learners",
    "programs.medical.title": "Medical Camps",
    "programs.medical.desc": "Monthly free health checkup camps in underserved villages with medicines and referral support.",
    "programs.medical.h1": "Monthly camps",
    "programs.medical.h2": "Free medicines",
    "programs.medical.h3": "Specialist referrals",
    "programs.food.title": "Food Distribution",
    "programs.food.desc": "Regular food distribution drives ensuring no family goes hungry in our served communities.",
    "programs.food.h1": "15,000+ meals served",
    "programs.food.h2": "Weekly drives",
    "programs.food.h3": "Nutrition support",
    "programs.women.title": "Women Empowerment",
    "programs.women.desc": "Skill development, micro-finance, and leadership training for rural women.",
    "programs.women.h1": "Skill workshops",
    "programs.women.h2": "Micro-finance access",
    "programs.women.h3": "Self-help groups",
    "programs.volunteerCta": "Volunteer for this program",
    "blog.title": "Stories & Blog",
    "blog.subtitle": "Real stories from the ground - every life we touch matters",
    "blog.empty": "No blog posts published yet.",
    "notices.title": "Notices & Announcements",
    "notices.subtitle": "Stay updated with our latest events and opportunities",
    "notices.pinned": "Pinned",
    "notices.published": "Published: {date}",
    "notices.expires": "Expires: {date}",
    "notices.download": "Download",
    "notices.empty": "No active notices.",
  },
  bn: {
    "lang.en": "English",
    "lang.bn": "বাংলা",
    "lang.hi": "हिंदी",
    "lang.ar": "العربية",
    "site.name": "হোপফাউন্ডেশন",
    "nav.home": "হোম",
    "nav.about": "আমাদের সম্পর্কে",
    "nav.work": "আমাদের কাজ",
    "nav.programs": "প্রোগ্রাম",
    "nav.gallery": "গ্যালারি",
    "nav.blog": "ব্লগ",
    "nav.notices": "নোটিশ",
    "nav.transparency": "স্বচ্ছতা",
    "cta.donateNow": "এখনই দান করুন",
    "cta.volunteer": "স্বেচ্ছাসেবক",
    "admin.dashboard": "ড্যাশবোর্ড",
    "admin.files": "ফাইল ম্যানেজার",
    "admin.usersRoles": "ইউজার ও রোল",
    "admin.logout": "লগআউট",
    "language.label": "ভাষা",
    "footer.tagline": "২০২১ সাল থেকে গ্রামীণ মানুষের জন্য বিনামূল্যে শিক্ষা, স্বাস্থ্যসেবা ও ক্ষমতায়ন।",
    "footer.quickLinks": "দ্রুত লিংক",
    "footer.getInvolved": "অংশ নিন",
    "footer.partner": "আমাদের সাথে অংশীদার হোন",
    "footer.transparency": "স্বচ্ছতা",
    "footer.reports": "বার্ষিক প্রতিবেদন দেখুন",
    "footer.rights": "সর্বস্বত্ব সংরক্ষিত।",
  },
  hi: {
    "lang.en": "English",
    "lang.bn": "বাংলা",
    "lang.hi": "हिंदी",
    "lang.ar": "العربية",
    "site.name": "होपफाउंडेशन",
    "nav.home": "होम",
    "nav.about": "हमारे बारे में",
    "nav.work": "हमारा काम",
    "nav.programs": "कार्यक्रम",
    "nav.gallery": "गैलरी",
    "nav.blog": "ब्लॉग",
    "nav.notices": "सूचनाएं",
    "nav.transparency": "पारदर्शिता",
    "cta.donateNow": "अभी दान करें",
    "cta.volunteer": "स्वयंसेवक",
    "admin.dashboard": "डैशबोर्ड",
    "admin.files": "फाइल मैनेजर",
    "admin.usersRoles": "यूजर और रोल",
    "admin.logout": "लॉगआउट",
    "language.label": "भाषा",
    "footer.tagline": "2021 से ग्रामीण समुदायों के लिए निःशुल्क शिक्षा, स्वास्थ्य सेवा और सशक्तिकरण।",
    "footer.quickLinks": "त्वरित लिंक",
    "footer.getInvolved": "जुड़ें",
    "footer.partner": "हमारे साथ साझेदारी करें",
    "footer.transparency": "पारदर्शिता",
    "footer.reports": "वार्षिक रिपोर्ट देखें",
    "footer.rights": "सर्वाधिकार सुरक्षित।",
  },
  ar: {
    "lang.en": "English",
    "lang.bn": "বাংলা",
    "lang.hi": "हिंदी",
    "lang.ar": "العربية",
    "site.name": "هوب فاونديشن",
    "nav.home": "الرئيسية",
    "nav.about": "من نحن",
    "nav.work": "أعمالنا",
    "nav.programs": "البرامج",
    "nav.gallery": "المعرض",
    "nav.blog": "المدونة",
    "nav.notices": "الإعلانات",
    "nav.transparency": "الشفافية",
    "cta.donateNow": "تبرع الآن",
    "cta.volunteer": "تطوع",
    "admin.dashboard": "لوحة التحكم",
    "admin.files": "إدارة الملفات",
    "admin.usersRoles": "المستخدمون والأدوار",
    "admin.logout": "تسجيل الخروج",
    "language.label": "اللغة",
    "footer.tagline": "تقديم التعليم والرعاية الصحية والتمكين مجانًا للمجتمعات الريفية منذ 2021.",
    "footer.quickLinks": "روابط سريعة",
    "footer.getInvolved": "شارك معنا",
    "footer.partner": "كن شريكًا معنا",
    "footer.transparency": "الشفافية",
    "footer.reports": "عرض التقارير السنوية",
    "footer.rights": "جميع الحقوق محفوظة.",
  },
};

interface I18nContextValue {
  language: Language;
  locale: string;
  isRTL: boolean;
  setLanguage: (language: Language) => void;
  t: (key: string, vars?: Record<string, string | number>) => string;
}

const I18nContext = createContext<I18nContextValue | undefined>(undefined);

function interpolate(template: string, vars?: Record<string, string | number>) {
  if (!vars) return template;
  return Object.entries(vars).reduce((out, [key, value]) => out.replaceAll(`{${key}}`, String(value)), template);
}

function isLanguage(value: string | null): value is Language {
  return value === "en" || value === "bn" || value === "hi" || value === "ar";
}

export function I18nProvider({ children }: { children: ReactNode }) {
  const [language, setLanguage] = useState<Language>(() => {
    if (typeof window === "undefined") return "en";
    const saved = window.localStorage.getItem(LANGUAGE_STORAGE_KEY);
    return isLanguage(saved) ? saved : "en";
  });

  useEffect(() => {
    window.localStorage.setItem(LANGUAGE_STORAGE_KEY, language);
    document.documentElement.lang = language;
    document.documentElement.dir = language === "ar" ? "rtl" : "ltr";
  }, [language]);

  const value = useMemo<I18nContextValue>(
    () => ({
      language,
      locale: localeMap[language],
      isRTL: language === "ar",
      setLanguage,
      t: (key, vars) => interpolate(translations[language][key] ?? translations.en[key] ?? key, vars),
    }),
    [language],
  );

  return <I18nContext.Provider value={value}>{children}</I18nContext.Provider>;
}

export function useI18n() {
  const context = useContext(I18nContext);
  if (!context) {
    throw new Error("useI18n must be used within I18nProvider");
  }
  return context;
}
